Author: Steve Langasek <steve.langasek@ubuntu.com>
Description: enable the NVMe driver
 Enable the driver for NVMe disks, not enabled by default upstream.
Bug-Ubuntu: https://bugs.launchpad.net/bugs/1267816

Index: edk2-debian/OvmfPkg/OvmfPkgIa32.dsc
===================================================================
--- edk2-debian.orig/OvmfPkg/OvmfPkgIa32.dsc
+++ edk2-debian/OvmfPkg/OvmfPkgIa32.dsc
@@ -550,6 +550,11 @@
   MdeModulePkg/Bus/Usb/UsbKbDxe/UsbKbDxe.inf
   MdeModulePkg/Bus/Usb/UsbMassStorageDxe/UsbMassStorageDxe.inf
 
+  #
+  # NVMe Support
+  #
+  MdeModulePkg/Bus/Pci/NvmExpressDxe/NvmExpressDxe.inf
+
 !ifdef $(CSM_ENABLE)
   IntelFrameworkModulePkg/Csm/BiosThunk/VideoDxe/VideoDxe.inf {
     <LibraryClasses>
Index: edk2-debian/OvmfPkg/OvmfPkgIa32.fdf
===================================================================
--- edk2-debian.orig/OvmfPkg/OvmfPkgIa32.fdf
+++ edk2-debian/OvmfPkg/OvmfPkgIa32.fdf
@@ -337,6 +337,11 @@ INF  MdeModulePkg/Bus/Usb/UsbBusDxe/UsbB
 INF  MdeModulePkg/Bus/Usb/UsbKbDxe/UsbKbDxe.inf
 INF  MdeModulePkg/Bus/Usb/UsbMassStorageDxe/UsbMassStorageDxe.inf
 
+#
+# NVMe support
+#
+INF  MdeModulePkg/Bus/Pci/NvmExpressDxe/NvmExpressDxe.inf
+
 !ifdef $(CSM_ENABLE)
 INF  IntelFrameworkModulePkg/Csm/BiosThunk/VideoDxe/VideoDxe.inf
 INF  IntelFrameworkModulePkg/Csm/LegacyBiosDxe/LegacyBiosDxe.inf
Index: edk2-debian/OvmfPkg/OvmfPkgIa32X64.dsc
===================================================================
--- edk2-debian.orig/OvmfPkg/OvmfPkgIa32X64.dsc
+++ edk2-debian/OvmfPkg/OvmfPkgIa32X64.dsc
@@ -557,6 +557,11 @@
   MdeModulePkg/Bus/Usb/UsbKbDxe/UsbKbDxe.inf
   MdeModulePkg/Bus/Usb/UsbMassStorageDxe/UsbMassStorageDxe.inf
 
+  #
+  # NVMe Support
+  #
+  MdeModulePkg/Bus/Pci/NvmExpressDxe/NvmExpressDxe.inf
+
 !ifdef $(CSM_ENABLE)
   IntelFrameworkModulePkg/Csm/BiosThunk/VideoDxe/VideoDxe.inf {
     <LibraryClasses>
Index: edk2-debian/OvmfPkg/OvmfPkgIa32X64.fdf
===================================================================
--- edk2-debian.orig/OvmfPkg/OvmfPkgIa32X64.fdf
+++ edk2-debian/OvmfPkg/OvmfPkgIa32X64.fdf
@@ -337,6 +337,11 @@ INF  MdeModulePkg/Bus/Usb/UsbBusDxe/UsbB
 INF  MdeModulePkg/Bus/Usb/UsbKbDxe/UsbKbDxe.inf
 INF  MdeModulePkg/Bus/Usb/UsbMassStorageDxe/UsbMassStorageDxe.inf
 
+# 
+# NVMe support
+#
+INF  MdeModulePkg/Bus/Pci/NvmExpressDxe/NvmExpressDxe.inf
+
 !ifdef $(CSM_ENABLE)
 INF  IntelFrameworkModulePkg/Csm/BiosThunk/VideoDxe/VideoDxe.inf
 INF  IntelFrameworkModulePkg/Csm/LegacyBiosDxe/LegacyBiosDxe.inf
Index: edk2-debian/OvmfPkg/OvmfPkgX64.dsc
===================================================================
--- edk2-debian.orig/OvmfPkg/OvmfPkgX64.dsc
+++ edk2-debian/OvmfPkg/OvmfPkgX64.dsc
@@ -555,6 +555,11 @@
   MdeModulePkg/Bus/Usb/UsbKbDxe/UsbKbDxe.inf
   MdeModulePkg/Bus/Usb/UsbMassStorageDxe/UsbMassStorageDxe.inf
 
+  #
+  # NVMe Support
+  #
+  MdeModulePkg/Bus/Pci/NvmExpressDxe/NvmExpressDxe.inf
+
 !ifdef $(CSM_ENABLE)
   IntelFrameworkModulePkg/Csm/BiosThunk/VideoDxe/VideoDxe.inf {
     <LibraryClasses>
Index: edk2-debian/OvmfPkg/OvmfPkgX64.fdf
===================================================================
--- edk2-debian.orig/OvmfPkg/OvmfPkgX64.fdf
+++ edk2-debian/OvmfPkg/OvmfPkgX64.fdf
@@ -337,6 +337,11 @@ INF  MdeModulePkg/Bus/Usb/UsbBusDxe/UsbB
 INF  MdeModulePkg/Bus/Usb/UsbKbDxe/UsbKbDxe.inf
 INF  MdeModulePkg/Bus/Usb/UsbMassStorageDxe/UsbMassStorageDxe.inf
 
+# 
+# NVMe support
+#
+INF  MdeModulePkg/Bus/Pci/NvmExpressDxe/NvmExpressDxe.inf
+
 !ifdef $(CSM_ENABLE)
 INF  IntelFrameworkModulePkg/Csm/BiosThunk/VideoDxe/VideoDxe.inf
 INF  IntelFrameworkModulePkg/Csm/LegacyBiosDxe/LegacyBiosDxe.inf
